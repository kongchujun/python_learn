CREATE TABLE company_info (
    company VARCHAR(255), -- 公司名字，字符串类型
    summary TEXT,         -- 总结，文本类型，可以储存较多的字数
    record TIMESTAMP      -- 记录时间，时间戳类型
);


import psycopg2
from datetime import datetime

# 数据库连接参数
conn_params = {
    "dbname": "your_database_name",
    "user": "your_username",
    "password": "your_password",
    "host": "localhost",  # 或者其他数据库服务器地址
    "port": "5432"         # 根据实际情况调整端口
}

# 创建连接
conn = psycopg2.connect(**conn_params)
cursor = conn.cursor()

# 获取今天的日期，只包括年月日
today = datetime.now().date()

# 删除今天已有的数据的 SQL 语句
delete_sql = """
DELETE FROM company_info WHERE record::date = %s;
"""

# 执行删除操作
cursor.execute(delete_sql, (today,))
conn.commit()  # 提交事务以确保删除操作生效

# 插入数据的 SQL 语句
insert_sql = """
INSERT INTO company_info (company, summary, record)
VALUES (%s, %s, %s);
"""

# 假设这是从某个外部源生成的数据列表
data_list = [
    {'company': 'a', 'summary': 'abcdesfsdf', 'record': datetime.now()},
    {'company': 'b', 'summary': 'another summary', 'record': datetime.now()}
]

# 准备数据以符合 executemany 的要求
formatted_data = [(d['company'], d['summary'], d['record']) for d in data_list]

# 执行批量插入操作
cursor.executemany(insert_sql, formatted_data)
conn.commit()  # 提交事务

# 关闭游标和连接
cursor.close()
conn.close()

print("Data inserted successfully.")
