import asyncio
import json
import datetime
import websocket

async def main():
    url = 'wss://ws-subscriptions-clob.polymarket.com/ws/market'
    last_time_pong = datetime.datetime.now()
    msgs = []

    kamala_trump_yes_token = "112691550711713354714525509796202337193505769808087674259394206524293080902258"
    kamala_trump_no_token = "40934908860656143479579576067633881276941830984503767038689094076378988206631"

    trump_win_election_yes = "21742633143463906290569050155826241533067272736897614950488156847949938836455"
    trump_win_election_no = "48331043336612883890938759509493159234755048973500640148014422747788308965732"

    async with websocket.AWebSocketApp(
        url,
        http_proxy_host="代理服务器地址",
        http_proxy_port=代理服务器端口,
        proxy_type="http"
    ) as ws:
        await ws.send(json.dumps({"assets_ids":[trump_win_election_yes, trump_win_election_no],"type":"market"}))

        while True:
            m = await ws.recv()
            if m != "PONG":
                last_time_pong = datetime.datetime.now()
                d = json.loads(m)
                print(d)
                msgs.append(d)
            if last_time_pong + datetime.timedelta(seconds=10) < datetime.datetime.now():
                await ws.send("PING")

# 运行异步主函数
asyncio.get_event_loop().run_until_complete(main())
