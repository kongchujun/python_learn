<clickhouse>
  <openSSL>
    <client>
      <verificationMode>none</verificationMode>
    </client>
  </openSSL>
</clickhouse>

<clickhouse>
  <storage_configuration>
    <disks>
      <s3>
        <type>object_storage</type>
        <object_storage_type>s3</object_storage_type>
        <endpoint>https://s3.<region>.amazonaws.com/your-bucket/path/</endpoint>
        <access_key_id>YOUR_ACCESS_KEY</access_key_id>
        <secret_access_key>YOUR_SECRET_KEY</secret_access_key>
        <metadata_type>local</metadata_type>
      </s3>
    </disks>
    <policies>
      <s3_policy>
        <volumes>
          <main>
            <disk>s3</disk>
          </main>
        </volumes>
      </s3_policy>
    </policies>
  </storage_configuration>
  <merge_tree>
    <storage_policy>s3_policy</storage_policy>
  </merge_tree>
</clickhouse>


version: "3.8"
services:
  clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: clickhouse
    user: "101:101"
    volumes:
      - ./config.d/s3disk.xml:/etc/clickhouse-server/config.d/s3disk.xml:ro
      - clickhouse_data:/var/lib/clickhouse
    ports:
      - "8123:8123"
      - "9000:9000"

volumes:
  clickhouse_data:
    driver: local
