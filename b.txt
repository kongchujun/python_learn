<clickhouse>
    <merge_tree>
        <storage_policy>s3</storage_policy>
    </merge_tree>
    <disks>
        <s3>
            <type>object_storage</type>
            <object_storage_type>s3</object_storage_type>
            <metadata_type>local</metadata_type>
            <endpoint>https://s3.<region>.amazonaws.com/<bucket-name>/data/</endpoint>
            <access_key_id><your-access-key></access_key_id>
            <secret_access_key><your-secret-key></secret_access_key>
        </s3>
    </disks>
    <policies>
        <s3>
            <volumes>
                <main>
                    <disk>s3</disk>
                </main>
            </volumes>
        </s3>
    </policies>
</clickhouse>



services:
  clickhouse:
    image: clickhouse/clickhouse-server
    user: "101:101"
    container_name: clickhouse
    hostname: clickhouse
    environment:
      CLICKHOUSE_DB: default
      CLICKHOUSE_USER: clickhouse
      CLICKHOUSE_PASSWORD: clickhouse
    volumes:
      - ./config.xml:/etc/clickhouse-server/config.d/s3disk.xml:ro
      - langfuse_clickhouse_data:/var/lib/clickhouse
      - langfuse_clickhouse_logs:/var/log/clickhouse-server
    ports:
      - "8123:8123"
      - "9000:9000"

volumes:
  langfuse_clickhouse_data:
    driver: local
  langfuse_clickhouse_logs:
    driver: local



CREATE TABLE test_table (
    id UInt32,
    name String
) ENGINE = MergeTree()
ORDER BY id
SETTINGS storage_policy = 's3';

INSERT INTO test_table VALUES (1, 'example');
SELECT * FROM test_table;
