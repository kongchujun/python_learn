// readStartupMessage 解析 StartupMessage
func readStartupMessage(r *bufio.Reader) (*StartupMessage, error) {
    header := make([]byte, 8)
    if _, err := io.ReadFull(r, header); err != nil {
        return nil, err
    }
    length := int(binary.BigEndian.Uint32(header[:4]))
    if length < 8 {
        return nil, fmt.Errorf("invalid startup message length: %d", length)
    }
    body := make([]byte, length-8)
    if _, err := io.ReadFull(r, body); err != nil {
        return nil, err
    }
    version := int32(binary.BigEndian.Uint32(header[4:8]))
    var params map[string]string
    if len(body) > 4 {
        params, _ = parseParameters(body[4:])
    } else {
        params = make(map[string]string)
    }
    return &StartupMessage{ProtocolVersion: version, Parameters: params, Raw: append(header, body...)}, nil
}
