import pandas as pd
import json
from anytree import Node, RenderTree
from anytree.exporter import DictExporter
from flask import Flask, render_template_string

# Read the CSV file
df = pd.read_csv('tree_structure.csv')

# Create a dictionary to store nodes
nodes = {}

# Create nodes for each row in the CSV file
for index, row in df.iterrows():
    name = row['name']
    parent_name = row['parent']
    level = row['level']

    if pd.isna(parent_name) or parent_name.strip() == "":
        nodes[name] = Node(name)
    else:
        nodes[name] = Node(name, parent=nodes[parent_name])

# Convert tree structure to dictionary format for JSON
root_nodes = [node for node in nodes.values() if node.is_root]
exporter = DictExporter()
tree_data = [exporter.export(root) for root in root_nodes]

# Create Flask app
app = Flask(__name__)

# HTML template to render the tree structure on a webpage
html_template = '''
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Structure</title>
    <link rel="stylesheet" href="jquery.treeview.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="jquery.treeview.js"></script>
    <script>
        $(document).ready(function() {
            $("#tree").treeview({
                collapsed: true,
                animated: "fast",
                unique: true
            });
        });

        function buildTree(data) {
            let html = '';
            for (const node of data) {
                html += '<li>' + node.name;
                if (node.children && node.children.length > 0) {
                    html += '<ul>' + buildTree(node.children) + '</ul>';
                }
                html += '</li>';
            }
            return html;
        }
    </script>
</head>
<body>
    <h1>Tree Structure</h1>
    <ul id="tree">
        <script>
            document.write(buildTree({{ tree_data|safe }}));
        </script>
    </ul>
</body>
</html>
'''


# Flask route to display the tree
@app.route('/')
def show_tree():
    return render_template_string(html_template, tree_data=json.dumps(tree_data))


if __name__ == "__main__":
    app.run(debug=True)
